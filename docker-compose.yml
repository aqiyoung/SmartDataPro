version: '3.8'

services:
  backend:
    image: python:3.11-slim
    container_name: document-converter-backend
    ports:
      - "8006:8006"
    environment:
      - PYTHONUNBUFFERED=1
      - TESSDATA_PREFIX=/usr/share/tesseract-ocr/5/tessdata/
    volumes:
      - /tmp:/tmp
      - ./backend:/app
    working_dir: /app
    command: /bin/bash -c "echo '=== 后端服务部署开始 ==='; apt-get update; apt-get install -y tesseract-ocr tesseract-ocr-chi-sim gcc python3-dev; pip3 install -r requirements.txt; echo '=== 依赖安装完成，启动应用 ==='; python3 main.py"
    networks:
      - converter-network
    restart: unless-stopped

  frontend:
    image: nginx:alpine
    container_name: document-converter-frontend
    ports:
      - "5180:80"
    depends_on:
      - backend
    volumes:
      - ./frontend/dist:/usr/share/nginx/html
    networks:
      - converter-network
    restart: unless-stopped

networks:
  converter-network:
    driver: bridge
    name: document-converter-network