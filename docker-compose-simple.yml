version: '3.8'

services:
  backend:
    # 使用基础Python镜像
    image: python:3.11-slim
    container_name: document-converter-backend
    ports:
      - "8006:8006"
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      - ./backend:/app
    working_dir: /app
    # 修复命令执行问题，确保每个命令正确执行
    command: /bin/bash -c "
      echo '=== 后端服务部署开始 ===';
      # 分步执行命令，避免shell解析错误
      apt-get update;
      apt-get install -y tesseract-ocr tesseract-ocr-chi-sim gcc python3-dev;
      # 使用pip3明确指定Python3
      pip3 install -r requirements.txt;
      echo '=== 依赖安装完成，启动应用 ===';
      python3 main.py;
      echo '=== 应用启动完成 ===';
      "
    restart: unless-stopped
    networks:
      - app-network

  frontend:
    # 使用基础Nginx镜像
    image: nginx:alpine
    container_name: document-converter-frontend
    ports:
      - "5180:80"
    volumes:
      - ./frontend/dist:/usr/share/nginx/html
    restart: unless-stopped
    depends_on:
      - backend
    networks:
      - app-network

networks:
  app-network:
    driver: bridge